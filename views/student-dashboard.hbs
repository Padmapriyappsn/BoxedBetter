<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/theme.css"> <!-- Ensure this stylesheet is included -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #2c6e49;
            color: white;
        }
        #map { height: 400px; width: 100%; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Welcome, {{student.firstName}}!</h1>
    <header>
        <h2 style="color: white;">Student Dashboard</h2>
        <nav>
            <select id="nav-dropdown" onchange="window.location.href=this.value;" class="custom-btn">
                <option value="#">Select an option</option>
                <option value="/student/orders">View Orders</option>
                <option value="/student/orders">Place Order</option>
                <option value="/track-order">Track Order</option>
                <option value="/restaurants">Review Restaurant</option>
            </select>
            <a href="/student/logout" class="custom-btn">Logout</a>
        </nav>
    </header>

    <section>
        <h2>Choose Location to Pickup Order</h2>

        <!-- Map Integration -->
        <div id="map"></div>
        <label for="pickup-location">Selected Location:</label>
        <input type="text" id="pickup-location" readonly>

        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <script>
            // Initialize the map centered on Toronto, Canada
            var map = L.map('map').setView([43.65107, -79.347015], 13); // Toronto, Canada

            // Set up OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Marker to track the chosen location
            var marker = L.marker([43.65107, -79.347015], { draggable: true }).addTo(map);

            // Update location when clicked on the map
            map.on('click', function(event) {
                marker.setLatLng(event.latlng);
                updateLocation(event.latlng.lat, event.latlng.lng);
            });

            // Update location when the marker is dragged
            marker.on('dragend', function(event) {
                updateLocation(event.target.getLatLng().lat, event.target.getLatLng().lng);
            });

            // Function to get the address of a location
            function updateLocation(lat, lng) {
                var geocodeUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1`;

                fetch(geocodeUrl)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('pickup-location').value = data.display_name || "Location not found";
                    });
            }
        </script>

        <!-- Available Food Items Table -->
        <h2>Available Food Items</h2>
        {{#if foods.length}}
            <table>
                <thead>
                    <tr>
                        <th>Food Name</th>
                        <th>Description</th>
                        <th>Discounted Price</th>
                        <th>Restaurant</th>
                        <th>Quantity</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each foods}}
                        <tr>
                            <td>{{this.foodName}}</td>
                            <td>{{this.description}}</td>
                            <td>${{this.discountedPrice}}</td>
                            <td>{{this.restaurantName}}</td>
                            <td>
                                <form action="/student/orders" method="POST">
                                    <input type="hidden" name="foodItemId" value="{{this.foodId}}">
                                    <input type="number" name="quantity" min="1" value="1" required class="form-control" style="width: 60px;">
                            </td>
                            <td>
                                    <button type="submit" class="custom-btn">Order Now</button>
                                </form>
                            </td>
                        </tr>
                    {{/each}}
                </tbody>
            </table>
        {{else}}
            <p>No food items available at the moment. Please check back later!</p>
        {{/if}}
    </section>
    <div>
            <img src="https://playatgila.com/wp-content/uploads/Panda-Express-Bowl-Lrg.png" alt="Meals" width="300" height="300">
            <img src="https://tb-static.uber.com/prod/image-proc/processed_images/0da00f84d6d6b0ea64ef3d7e7fe0889c/783282f6131ef2258e5bcd87c46aa87e.jpeg" alt="Panda express meals" width="300" height="300">
    </div>

</body>
</html>
